<!DOCTYPE html>
<!--  Last Published: Thu Aug 10 2017 07:10:06 GMT+0000 (UTC)  -->
<html data-wf-page="57fa1e2cfb1c83e918358d6d" data-wf-site="57f9f32654bcd3af639ec7f2" lang="deu">
<head>
  <meta charset="utf-8">
  <title>Amtliches Videokonferenz Portal</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/amtliches-videokonferenz-portal.webflow.css" rel="stylesheet" type="text/css">
  <link href="css/">
  <link rel="stylesheet" type="text/css" href="css/flatpickr.css">
  <link rel="stylesheet" type="text/css" href="css/confirmDate.css">
  <script src="js/flatpickr.js"></script>
  <script src="js/confirmDate.js"></script>
  <script src="js/moment.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({
  google: {
    families: ["Open Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic","Roboto:300,regular,500"]
  }
});</script>
  <!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);
</script>
  <link href="images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
</head>
<body>
  <div class="navigation-bar w-nav" data-animation="default" data-collapse="medium" data-duration="400">
    <div class="hamburger-button w-nav-button">
      <div class="w-icon-nav-menu"></div>
    </div>
    <nav class="navigation-menu w-clearfix w-nav-menu" role="navigation"><a class="navigation-link w-nav-link" href="index.html">Home</a></nav>
    <div class="navpanel w-container"><img class="logo" src="images/Logo.png">
      <a class="brand-link w-clearfix w-nav-brand" href="index.html">
        <h1 class="brand-text">Amtliches Videokonferenz Portal</h1>
      </a>
    </div>
  </div>
  <div class="centered hero-section herosectionamt">
    <div class="w-container" data-ix="new-interaction">
      <h1 class="hero-heading" data-ix="fade-in-bottom-page-loads">Termin Vereinbaren</h1>
      <div class="hero-subheading" data-ix="fade-in-bottom-page-loads">Legen Sie fest, wann Sie zeit haben</div>
      <div data-ix="fade-in-bottom-page-loads"><a class="button" href="#Terminwahl">Termin Festlegen</a><a class="all-caps hollow-button" href="#Help">Hilfe</a></div>
    </div>
  </div>
  
  
  <div class="section" id="Terminwahl">
    <div id="success-dataFound-anfrage" class="w-container" style="display:none">
      <div class="section-title-group">
        <div class="center section-subheading subheading-terminwahl">Geben Sie Hier ihren Wunschtermin an:</div>
      </div>
      
      
      <!-- Appointment 1: Programmatische Anpassung -->
      <div>
        <div id="appointmentContainer1" class="appointmentblock">
          <h2>Wunschtermin</h2>
          <p>Klicken Sie hier, um ihren Wunschtermin festzulegen ...</p>
          <div data-ix="fade-in-bottom-page-loads">
          	<a class="button" data-ix="showcalendar" href="#appointmentContainer1">Termin Auswählen</a>
          	<a id="appointment1Selected" class="all-caps appointmentselected hollow-button" href="#">Ausgewählt</a>
            
            <!-- Calendar for Appointment 1 - set programmatically -->
            <div id="calendar1Wrapper" class="calendar">
            	<p></p><input id="calendarElement1" placeholder="Wunschtermin auswählen ..." style="display:none; width: 50%; min-Width: 250px">
            	
		        <div id="availableAppointments1" class="AvalaibleAppointments_List" style="display:none;">
					<h4><span>Verfügbare Termine am </span><strong>%DATUM%</strong><span></span></h4>
					<div id="availableAppointments1list">
						<!-- Programmatically inserted -->
					</div>
					<div id="noAppointmentsAvailable1" style="display:none">
						<p>Für das ausgewählte Datum sind keine Termine mehr frei!</p>
					</div>
				</div>
            </div>
            
            <!-- Mitarbeiter zu Appointment 1 -->
            <div id="appointmentconnectedemployee1" class="appointmentconnectedemployee">
              <div class="section-title-group">
                <div class="center section-subheading subheading-terminwahl">Zugewiesene mitarbeiter:</div>
              </div>
              <div class="w-dyn-list">
                <div id="selectedEmployee1" class="w-dyn-items">
                  <!-- Programmatische Befüllung -->
                </div>
              </div>
            </div>
            <!-- Mitarbeiter zu Appointment 1 -->
            
          </div>
        </div>
      </div>
      <!-- Appointment 1 ENDE -->
      
      <!-- Appointment 2: Programmatische Anpassung -->
      <div>
        <div id="appointmentContainer2" class="appointmentblock">
          <h2>Alternativtermin 1</h2>
          <p>Klicken Sie hier, um ihren Wunschtermin festzulegen ...</p>
          <div data-ix="fade-in-bottom-page-loads">
          	<a class="button" data-ix="showcalendar" href="#appointmentContainer2">Termin Auswählen</a>
          	<a id="appointment2Selected" class="all-caps appointmentselected hollow-button" href="#">Ausgewählt</a>
            
            <!-- Calendar for Appointment 2 - set programmatically -->
            <div id="calendar2Wrapper" class="calendar">
            	<p></p><input id="calendarElement2" placeholder="Wunschtermin auswählen ..." style="display:none; width: 50%; min-Width: 250px">
            	
		        <div id="availableAppointments2" class="AvalaibleAppointments_List" style="display:none;">
					<h4><span>Verfügbare Termine am </span><strong>%DATUM%</strong><span></span></h4>
					<div id="availableAppointments2list">
						<!-- Programmatically inserted -->
					</div>
					<div id="noAppointmentsAvailable2" style="display:none">
						<p>Für das ausgewählte Datum sind keine Termine mehr frei!</p>
					</div>
				</div>
            </div>
            
            <!-- Mitarbeiter zu Appointment 2 -->
            <div  id="appointmentconnectedemployee2" class="appointmentconnectedemployee">
              <div class="section-title-group">
                <div class="center section-subheading subheading-terminwahl">Zugewiesene Mitarbeiter:</div>
              </div>
              <div class="w-dyn-list">
                <div id="selectedEmployee2" class="w-dyn-items">
                  <!-- Programmatische Befüllung -->
                </div>
              </div>
            </div>
            <!-- Mitarbeiter zu Appointment 2 -->
            
          </div>
        </div>
      </div>
      <!-- Appointment 2 ENDE -->
      
      <!-- Appointment 3: Programmatische Anpassung -->
      <div>
        <div id="appointmentContainer3" class="appointmentblock">
          <h2>Alternativtermin 2</h2>
          <p>Klicken Sie hier, um ihren Wunschtermin festzulegen ...</p>
          <div data-ix="fade-in-bottom-page-loads">
          	<a class="button" data-ix="showcalendar" href="#appointmentContainer3">Termin Auswählen</a>
          	<a id="appointment3Selected" class="all-caps appointmentselected hollow-button" href="#">Ausgewählt</a>
            
            <!-- Calendar for Appointment 3 - set programmatically -->
            <div id="calendar3Wrapper" class="calendar">
            	<p></p><input id="calendarElement3" placeholder="Wunschtermin auswählen ..." style="display:none; width: 50%; min-Width: 250px">
            	
		        <div id="availableAppointments3" class="AvalaibleAppointments_List" style="display:none;">
					<h4><span>Verfügbare Termine am </span><strong>%DATUM%</strong><span></span></h4>
					<div id="availableAppointments3list">
						<!-- Programmatically inserted -->
					</div>
					<div id="noAppointmentsAvailable3" style="display:none">
						<p>Für das ausgewählte Datum sind keine Termine mehr frei!</p>
					</div>
				</div>
            </div>
            <!-- Calendar END -->
            
            <!-- Mitarbeiter zu Appointment 3 -->
            <div  id="appointmentconnectedemployee3" class="appointmentconnectedemployee">
              <div class="section-title-group">
                <div class="center section-subheading subheading-terminwahl">Zugewiesene Mitarbeiter:</div>
              </div>
              <div class="w-dyn-list">
                <div id="selectedEmployee3" class="w-dyn-items">
                  <!-- Programmatische Befüllung -->
                </div>
              </div>
            </div>
            <!-- Mitarbeiter zu Appointment 3 -->
            
          </div>
        </div>
      </div>
      <!-- Appointment 3 ENDE -->
      
    <!-- Erst anzeigen, wenn alle 3 Termine ausgewählt wurden -->
    <div id="SummaryDisplayButton" data-ix="fade-in-bottom-page-loads" style="display:none"><a class="button buttonwide" href="#">Termin-Zusammenfassung anzeigen</a></div>
    </div> 
    <!-- ENDE -->
    
  	<div id="fail-nodata-anfrage" class="w-container" style="display:none">
  		<table>
  			<tr>
  				<td style="width:10%"></td>
  				<td style="width:35%"><img src="images/Typing_Monkey.png"></td>
  				<td style="width:10%"></td>
  				<td style="width:35%">
  					<h3>Fehler aufgereten</h3>
  					<p>Bei der Verarbeitung ist entweder ein Fehler aufgereten oder es sind gar keine Termine in den nächsten 3 Wochen beim ausgewählten Amt mehr frei.</p>
  					<p></p>
  					<p>Versuchen Sie es später entweder erneut oder wenden Sie sich an den Support (siehe Seite <a href="/misc/weitereInformationen.html">'Weitere Informationen'</a>).</p>
  				</td>
  				<td style="width:10%"></td>
  			</tr>
  		</table>
  	</div>
  	<div id="fail-summary-error" class="w-container" style="display:none">
  		<table>
  			<tr>
  				<td style="width:10%"></td>
  				<td style="width:35%"><img src="images/Typing_Monkey.png"></td>
  				<td style="width:10%"></td>
  				<td style="width:35%">
  					<h3>Fehler aufgereten</h3>
  					<p>Bei der Verarbeitung ist ein Fehler aufgereten: Die Terminvorschau konnte nicht erzeugt werden!</p>
  					<p></p>
  					<p>Versuchen Sie es später entweder erneut oder wenden Sie sich an den Support (siehe Seite <a href="/misc/weitereInformationen.html">'Weitere Informationen'</a>).</p>
  				</td>
  				<td style="width:10%"></td>
  			</tr>
  		</table>
  	</div>
  </div>
  <div class="section" id="Help">
    <div class="w-container">
      <div class="section-title-group">
        <h2 class="centered section-heading">Wie es funktioniert</h2>
      </div>
      <div class="w-clearfix white-box whiteboxhelp"><img class="grid-image help" src="images/feather-15-white.svg">
        <h3>termin vereinbaren</h3>
        <p>Wählen Sie über unsere Kalendarfunktion einfach aus, welcher Termin ihnen passt</p>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="w-container">
      <div class="w-row">
        <div class="spc w-col w-col-6">
          <h5>über das portal</h5>
          <p>Das Portal versuch Bürger und Ämter einfacher in Kontakt treten zu lassen. Entstanden ist es aus einem Forschungsprojekt der Hochschule Mainz.</p>
        </div>
        <div class="spc w-col w-col-6">
          <h5>Nützliche links</h5><a class="footer-link" href="misc/weitereinformationen.html">Weitere Informationen</a><a class="footer-link" href="misc/impressum.html">Impressum</a></div>
      </div>
    </div>
  </div>
  
  <!-- Summary -->
  <div id="appointmentSummary" class="modal-wrapper alwaysShowScrollbar" style="display:none">
    <div class="summary-wrapper">
      <div class="modal-container w-container">
        <div class="section-title-group">
          <div class="center section-subheading subheading-terminwahl">Geben Sie Hier ihren Wunschtermin an:</div>
          <h1>Terminzusammenfassung</h1>
        </div>
        <p>Die Zusammenfassung ihres Termins. Bitte prüfen Sie, ob die angezeigten Angaben korrekt sind. Falls ja füllen Sie bitte das Formular aus und senden Sie die Anfrage ab ...</p>
        <div class="appointmentblock">
          <h2 class="summary-header">Zuständiges Amt</h2>
          <div class="w-row">
            <div class="w-col w-col-3"><img class="summary-logo" sizes="(max-width: 479px) 100vw, (max-width: 767px) 67vw, 16vw"></div>
            <div class="w-col w-col-9">
              <div class="break summary text"></div>
              <div class="summary text"></div>
              <div class="break summary text"></div>
              <div class="summary text"></div>
              <div class="summary text"></div>
              <div class="summary text"></div>
            </div>
          </div>
        </div>
        <div>
          <div class="appointmentblock">
            <h2>Wunschtermin</h2>
            <h3>Freitag, 12.10.2016, 9:00 - 9:30 Uhr</h3>
            <div data-ix="fade-in-bottom-page-loads">
              <div class="appointmentconnectedemployee appointmentconnectedemployeesummary">
                <div class="w-dyn-list">
                  <div class="w-dyn-items">
                    <div class="w-dyn-item">
                      <div class="white-box whiteboxemployee">
                        <h6>Ihr Gespräch mit:</h6>
                        <div class="employeename summary">
                          <h3></h3>
                          <h3></h3>
                          <h3></h3>
                        </div>
                        <div class="employeetext summary"></div>
                        <div class="employeetextphone summary"></div>
                        <div class="employeetextanwesenheit summary"></div>
                        <div class="employeetextplz summary"></div>
                      </div>
                    </div>
                  </div>
                  <div class="w-dyn-empty">
                    <div class="noemployeefound">Keine freien Mitarbeiter zum ausgewählten Termin gefunden</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div>
          <div class="appointmentblock">
            <h2>Alternativtermin 1</h2>
            <h3>Montag, 15.10.2016, 9:00 - 9:30 Uhr</h3>
            <div data-ix="fade-in-bottom-page-loads">
              <div class="appointmentconnectedemployee appointmentconnectedemployeesummary">
                <div class="w-dyn-list">
                  <div class="w-dyn-items">
                    <div class="w-dyn-item">
                      <div class="white-box whiteboxemployee">
                        <h6>Ihr Gespräch mit:</h6>
                        <div class="employeename summary">
                          <h3></h3>
                          <h3></h3>
                          <h3></h3>
                        </div>
                        <div class="employeetext summary"></div>
                        <div class="employeetextphone summary"></div>
                        <div class="employeetextanwesenheit summary"></div>
                        <div class="employeetextplz summary"></div>
                      </div>
                    </div>
                  </div>
                  <div class="w-dyn-empty">
                    <div class="noemployeefound">Keine freien Mitarbeiter zum ausgewählten Termin gefunden</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div>
          <div class="appointmentblock">
            <h2>Alternativtermin 2</h2>
            <h3>Dienstag, 16.10.2016, 9:00 - 9:30 Uhr</h3>
            <div data-ix="fade-in-bottom-page-loads">
              <div class="appointmentconnectedemployee appointmentconnectedemployeesummary">
                <div class="w-dyn-list">
                  <div class="w-dyn-items">
                    <div class="w-dyn-item">
                      <div class="white-box whiteboxemployee">
                        <h6>Ihr Gespräch mit:</h6>
                        <div class="employeename summary">
                          <h5></h5>
                          <h5></h5>
                          <h5></h5>
                        </div>
                        <div class="employeetext summary"></div>
                        <div class="employeetextphone summary"></div>
                        <div class="employeetextanwesenheit summary"></div>
                        <div class="employeetextplz summary"></div>
                      </div>
                    </div>
                  </div>
                  <div class="w-dyn-empty">
                    <div class="noemployeefound">Keine freien Mitarbeiter zum ausgewählten Termin gefunden</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="w-form">
          <form data-name="Email Form" id="email-form" name="email-form">
            <h2>Ihre Daten</h2><select class="w-select" data-name="Anrede" id="Anrede" name="Anrede" required="required"><option value="Herr">Herr</option>
<option value="Frau">Frau</option></select><input class="w-input" data-name="Vorname" id="Vorname" maxlength="256" name="Vorname" placeholder="Vorname …" required="required" type="text"><input class="w-input" data-name="Nachname" id="Nachname" maxlength="256" name="Nachname" placeholder="Nachname …" required="required" type="text"><input class="w-input" data-name="Email" id="email" maxlength="256" name="email" placeholder="Email ...." required="required" type="email"><textarea class="w-input" id="field" maxlength="5000" name="field" placeholder="Ihre Frage ..." required="required"></textarea></form>
          <div class="w-form-done">
            <div>Thank you! Your submission has been received!</div>
          </div>
          <div class="w-form-fail">
            <div>Oops! Something went wrong while submitting the form</div>
          </div>
        </div>
        <div class="buttoncontainer" data-ix="fade-in-bottom-page-loads"><a class="button buttonwide" data-ix="modal-close" href="index.html">Termin-Anfrage Senden</a><a class="all-caps hollow-button modalclosebutton" data-ix="modal-close" href="#">Schliessen</a></div>
      </div>
    </div>
  </div>
  <!-- Summary ENDE -->
  
  <div class="center footer"></div>
  <script
		src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"
		type="text/javascript">
  </script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <script>
	var host = "localhost";
	var moeglicheTermine;
	var moeglicheTermin_datumsliste;
	
	var picker1;
	var picker2;
	var picker3;
	
	$().ready(function(){
		var errOcc = false;
		
		$( "#fail-nodata-anfrage" ).hide( "fast" );
		$( "#success-dataFound-anfrage" ).hide( "fast" );
		
		var urlParams = getUrlParams();
		
		console.log( $( "#appointment1Selected" ).text());
		console.log( $( "#appointmentconnectedemployee1" ).find("#EmployeeID").text() );
		

		console.log( $( "#appointment2Selected" ).text());
		console.log( $( "#appointmentconnectedemployee2" ).find("#EmployeeID").text() );
		
		
		console.log( $( "#appointment2Selected" ).text());
		console.log( $( "#appointmentconnectedemployee3" ).find("#EmployeeID").text() );
		
		
		$.ajax({
	    	headers: { 
	    	    "Accept": "application/json",
	        	"Content-Type": "application/json"
	    	},
		  	url: "http://" + host + ":8080/requestHandler/rest/request/getData/MoeglicheTermine/?user=AVP_Frontend&userAuth=test",
	    	type: "POST",
	    	dataType: "json",
	    	data: "{" + 
	    			"\"variables\": {" +
	    								"\"AMTS_ID\":" + urlParams.ID +
	    								"\"TERMIN_1_DATUM\":" + urlParams.ID +
	    								"\"TERMIN_1_SLOT\":" + urlParams.ID +
	    								"\"TERMIN_1_MA_ID\":" + urlParams.ID +
	    								"\"TERMIN_2_DATUM\":" + urlParams.ID +
	    								"\"TERMIN_2_SLOT\":" + urlParams.ID +
	    								"\"TERMIN_2_MA_ID\":" + urlParams.ID +
	    								"\"TERMIN_3_DATUM\":" + urlParams.ID +
	    								"\"TERMIN_3_SLOT\":" + urlParams.ID +
	    								"\"TERMIN_3_MA_ID\":" + urlParams.ID +
	    							"}" + 
	    		   "}"
		})
		.fail(function(data){
			errOcc = true;
			
	  		if ( console && console.log ) {
	  	  		console.log( data );
	  	  	}
		})
		.done(function( data ) {
  			moeglicheTermine = data.RESULT;
  			
  			moeglicheTermin_datumsliste = moeglicheTermine.reduce(function(keys, element){ 
  			    for (key in element) {
  			       keys.push(moment(key, "DD.MM.YYYY").format("DD.MM.YYYY"));
  			    } 
  			    return keys; 
  			},[]);
  			
  			createPicker1();
  			createPicker2();
  			createPicker3();
		})
		.always(function() {
    		if(errOcc){
  	  			$( "#fail-nodata-anfrage" ).show( "fast" );
				$( "#success-dataFound-anfrage" ).hide( "fast" );
    		}else{
  	  			$( "#fail-nodata-anfrage" ).hide( "fast" );
				$( "#success-dataFound-anfrage" ).show( "fast" );
			}
	  	});
	});
	
	$('#SummaryDisplayButton').click(function(){
		var errOcc = false;
		
		var urlParams = getUrlParams();
		
		$.ajax({
	    	headers: { 
	    	    "Accept": "application/json",
	        	"Content-Type": "application/json"
	    	},
		  	url: "http://" + host + ":8080/requestHandler/rest/request/getData/TerminZusammenfassung/?user=AVP_Frontend&userAuth=test",
	    	type: "POST",
	    	dataType: "json",
	    	data: "{" + 
	    			"\"variables\": {" + 
	    								"\"BERATUNGSGEBIET_ID\":" + urlParams.BERATUNGSGEBIET + "," + 
	    								"\"SERVICE_ID\":" + urlParams.SERVICE + 
	    								"\"AMTS_ID\":" + urlParams.ID +
	    							"}" + 
	    		   "}"
		})
		.fail(function(data){
			errOcc = true;
			
	  		if ( console && console.log ) {
	  	  		console.log( data );
  	  			$( "#success-dataFound-anfrage" ).hide( "fast" );
  	  			$( "#fail-summary-error" ).show('fast');
	  	  	}
		})
		.done(function( data ) {
  			terminZusammenfassung = data.RESULT;
  			
  			moeglicheTermin_datumsliste = moeglicheTermine.reduce(function(keys, element){ 
  			    for (key in element) {
  			       keys.push(moment(key, "DD.MM.YYYY").format("DD.MM.YYYY"));
  			    } 
  			    return keys; 
  			},[]);
  			
  			createPicker1();
  			createPicker2();
  			createPicker3();
		})
		.always(function() {
    		if(errOcc){
  	  			$( "#success-dataFound-anfrage" ).hide( "fast" );
  	  			$( "#fail-summary-error" ).show('fast');
    		}else{
  	  			$( "#appointmentSummary" ).show( "fast" );
			}
	  	});
	});
	
	function sortFunction(a, b) {
	    if (a[0] === b[0]) {
	        return 0;
	    }
	    else {
	        return (a[0] < b[0]) ? -1 : 1;
	    }
	}
	
	function createPicker1(){
		picker1 = flatpickr('#calendarElement1', { 
			dateFormat: 'd.m.Y',
			minDate: "today",
			maxDate: new Date().fp_incr(21),
			disable: [
		        function(date) {
		            return (date.getDay() === 6 || date.getDay() === 0);
		        }
		    ],
		    locale: {
		        firstDayOfWeek: 1 
		    },
		  	onChange: function(selectedDates, dateStr, instance) {
	        	$("#availableAppointments1").find("h4").find("strong").text(dateStr);

				$( "#availableAppointments1list" ).empty();
	        	
	    		for(var counter in moeglicheTermine){
					if(dateStr == Object.keys(moeglicheTermine[counter])[0]){
		    			var terminListe = moeglicheTermine[counter][dateStr];
		    			
		    			if(Object.keys(terminListe).length === 0 && terminListe.constructor === Object){
		    				$( "#noAppointmentsAvailable1" ).show( 'fast' );
		    			}else{
		    				$( "#noAppointmentsAvailable1" ).hide( 'fast' );
		    				
			    			var sortable = [];
			    			for (var t in terminListe) {
			    			    sortable.push([t, terminListe[t]]);
			    			}
			    			
		    				var terminListeSorted = sortable.sort(sortFunction);
		    				
			    			for(var counter2 in terminListeSorted){
			    				addTemplate($( "#availableAppointments1list" ), 
			    							terminListeSorted[counter2][1].SLOT.ANZEIGE, 
			    							1, 
			    							counter2, 
			    							terminListeSorted[counter2][1].SLOT.VON, 
			    							terminListeSorted[counter2][1].SLOT.BIS, 
			    							terminListeSorted[counter2][1].BERATER.ID, 
			    							terminListeSorted[counter2][1].BERATER.PROFILBILD.length == 0 ? "images/Profilbilder/Placeholder.PNG" : terminListeSorted[counter2][1].BERATER.PROFILBILD, 
			    							terminListeSorted[counter2][1].BERATER.VORNAME, 
			    							terminListeSorted[counter2][1].BERATER.NAME, 
			    							terminListeSorted[counter2][1].BERATER.TELEFON, 
			    							terminListeSorted[counter2][1].BERATER.EMAIL, 
			    							terminListeSorted[counter2][1].BERATER.TYP);
			    			}
		    			}
					}
	    		}
	      		
	        	$("#availableAppointments1").show('fast', function(){
		          	location.hash = "";
		          	location.hash = "#availableAppointments1";
	        	});
	    	},
	    	onDayCreate: function(dObj, dStr, fp, dayElem){
	    		var date = moment(dayElem.dateObj);
	    		
	    		for(var counter in moeglicheTermin_datumsliste){
					if(date.format('DD.MM.YYYY') == moeglicheTermin_datumsliste[counter]){
						if(Object.keys(moeglicheTermine[counter][date.format('DD.MM.YYYY')]).length > 0 && moeglicheTermine[counter][date.format('DD.MM.YYYY')].constructor === Object){
			    			dayElem.innerHTML += "<span class='appointmentAvailable'></span>";
						}
					}
	    		}
	    	},
	    	inline: true
		   });
	}
	
	function createPicker2(){
		picker2 = flatpickr('#calendarElement2', { 
			dateFormat: 'd.m.Y',
			minDate: "today",
			maxDate: new Date().fp_incr(21),
			disable: [
		        function(date) {
		            return (date.getDay() === 6 || date.getDay() === 0);
		        }
		    ],
		    locale: {
		        firstDayOfWeek: 1 
		    },
		  	onChange: function(selectedDates, dateStr, instance) {
	        	$("#availableAppointments2").find("h4").find("strong").text(dateStr);

				$( "#availableAppointments2list" ).empty();
	        	
	    		for(var counter in moeglicheTermine){
					if(dateStr == Object.keys(moeglicheTermine[counter])[0]){
		    			var terminListe = moeglicheTermine[counter][dateStr];
		    			
		    			if(Object.keys(terminListe).length === 0 && terminListe.constructor === Object){
		    				$( "#noAppointmentsAvailable2" ).show( 'fast' );
		    			}else{
		    				$( "#noAppointmentsAvailable2" ).hide( 'fast' );
		    				
			    			var sortable = [];
			    			for (var t in terminListe) {
			    			    sortable.push([t, terminListe[t]]);
			    			}
			    			
		    				var terminListeSorted = sortable.sort(sortFunction);
		    				
			    			for(var counter2 in terminListeSorted){
			    				addTemplate($( "#availableAppointments2list" ), 
			    							terminListeSorted[counter2][1].SLOT.ANZEIGE, 
			    							2, 
			    							counter2, 
			    							terminListeSorted[counter2][1].SLOT.VON, 
			    							terminListeSorted[counter2][1].SLOT.BIS, 
			    							terminListeSorted[counter2][1].BERATER.ID, 
			    							terminListeSorted[counter2][1].BERATER.PROFILBILD.length == 0 ? "images/Profilbilder/Placeholder.PNG" : terminListeSorted[counter2][1].BERATER.PROFILBILD, 
			    							terminListeSorted[counter2][1].BERATER.VORNAME, 
			    							terminListeSorted[counter2][1].BERATER.NAME, 
			    							terminListeSorted[counter2][1].BERATER.TELEFON, 
			    							terminListeSorted[counter2][1].BERATER.EMAIL, 
			    							terminListeSorted[counter2][1].BERATER.TYP);
			    			}
		    			}
					}
	    		}
	        	$( "#availableAppointments2" ).show('fast', function(){
		          	location.hash = "";
		          	location.hash = "#availableAppointments2";
	        	});
	    	},
	    	onDayCreate: function(dObj, dStr, fp, dayElem){
	    		var date = moment(dayElem.dateObj);
	    		
	    		for(var counter in moeglicheTermin_datumsliste){
					if(date.format('DD.MM.YYYY') == moeglicheTermin_datumsliste[counter]){
						if(Object.keys(moeglicheTermine[counter][date.format('DD.MM.YYYY')]).length > 0 && moeglicheTermine[counter][date.format('DD.MM.YYYY')].constructor === Object){
			    			dayElem.innerHTML += "<span class='appointmentAvailable'></span>";
						}
					}
	    		}
	    	},
	    	inline: true
		   });
	}
	
	function createPicker3(){
		picker3 = flatpickr('#calendarElement3', { 
			dateFormat: 'd.m.Y',
			minDate: "today",
			maxDate: new Date().fp_incr(21),
			disable: [
		        function(date) {
		            return (date.getDay() === 6 || date.getDay() === 0);
		        }
		    ],
		    locale: {
		        firstDayOfWeek: 1 
		    },
		  	onChange: function(selectedDates, dateStr, instance) {
	        	$("#availableAppointments3").find("h4").find("strong").text(dateStr);

				$( "#availableAppointments3list" ).empty();
	        	
	    		for(var counter in moeglicheTermine){
					if(dateStr == Object.keys(moeglicheTermine[counter])[0]){
		    			var terminListe = moeglicheTermine[counter][dateStr];

		    			if(Object.keys(terminListe).length === 0 && terminListe.constructor === Object){
		    				$( "#noAppointmentsAvailable3" ).show( 'fast' );
		    			}else{
		    				$( "#noAppointmentsAvailable3" ).hide( 'fast' );
		    				
			    			var sortable = [];
			    			for (var t in terminListe) {
			    			    sortable.push([t, terminListe[t]]);
			    			}
			    			
		    				var terminListeSorted = sortable.sort(sortFunction);

		    				
			    			for(var counter2 in terminListeSorted){
			    				addTemplate($( "#availableAppointments3list" ), 
			    							terminListeSorted[counter2][1].SLOT.ANZEIGE, 
			    							3, 
			    							counter2, 
			    							terminListeSorted[counter2][1].SLOT.VON, 
			    							terminListeSorted[counter2][1].SLOT.BIS, 
			    							terminListeSorted[counter2][1].BERATER.ID, 
			    							terminListeSorted[counter2][1].BERATER.PROFILBILD.length == 0 ? "images/Profilbilder/Placeholder.PNG" : terminListeSorted[counter2][1].BERATER.PROFILBILD, 
			    							terminListeSorted[counter2][1].BERATER.VORNAME, 
			    							terminListeSorted[counter2][1].BERATER.NAME, 
			    							terminListeSorted[counter2][1].BERATER.TELEFON, 
			    							terminListeSorted[counter2][1].BERATER.EMAIL, 
			    							terminListeSorted[counter2][1].BERATER.TYP);
			    			}
		    			}
					}
	    		}$("#availableAppointments3").show('fast', function(){
		          	location.hash = "";
		          	location.hash = "#availableAppointments3";
	    		});
	    	},
	    	onDayCreate: function(dObj, dStr, fp, dayElem){
	    		var date = moment(dayElem.dateObj);
	    		
	    		for(var counter in moeglicheTermin_datumsliste){
					if(date.format('DD.MM.YYYY') == moeglicheTermin_datumsliste[counter]){
						if(Object.keys(moeglicheTermine[counter][date.format('DD.MM.YYYY')]).length > 0 && moeglicheTermine[counter][date.format('DD.MM.YYYY')].constructor === Object){
			    			dayElem.innerHTML += "<span class='appointmentAvailable'></span>";
						}
					}
	    		}
    	},
    	inline: true
	   });
	}
  	
  	
  	function addTemplate(node, datum, datenr, slotnr, timefrom, timeto,
			   ma_id, ma_image, ma_vorname, ma_nachname, ma_telefon, ma_mail, ma_position){
  		jQuery.get('Templates/HTML-Snippets/Terminvorschlag.html', function(template) {
			   
			var filledInTemplate = template.replace("%DATUM%", datum);
		 	filledInTemplate = filledInTemplate.replace("%DATENR%", datenr);
		 	filledInTemplate = filledInTemplate.replace("%DATENR%", datenr);
		 	filledInTemplate = filledInTemplate.replace("%DATENR%", datenr);
		 	filledInTemplate = filledInTemplate.replace("%SLOTNR%", slotnr);
		 	filledInTemplate = filledInTemplate.replace("%SLOTNR%", slotnr);
		 	filledInTemplate = filledInTemplate.replace("%SLOTNR%", slotnr);
		 	filledInTemplate = filledInTemplate.replace("%TIMEFROM%", timefrom);
		 	filledInTemplate = filledInTemplate.replace("%TIMETO%", timeto);
		 	
		 	filledInTemplate = filledInTemplate.replace("%MA_ID%", ma_id);
		 	filledInTemplate = filledInTemplate.replace("%MA_IMAGE%", ma_image);
		 	filledInTemplate = filledInTemplate.replace("%MA_VORNAME%", ma_vorname);
		 	filledInTemplate = filledInTemplate.replace("%MA_NACHNAME%", ma_nachname);
		 	filledInTemplate = filledInTemplate.replace("%MA_TELEFON%", ma_telefon);
		 	filledInTemplate = filledInTemplate.replace("%MA_MAIL%", ma_mail);
		 	filledInTemplate = filledInTemplate.replace("%MA_POSITION%", ma_position);
			
		 	node.append(filledInTemplate);  
		});
	}
	
	  
	function addTemplateMA(node, id, image, vorname, nachname, telefon, mail, position){
		jQuery.get('Templates/HTML-Snippets/Mitarbeiter.html', function(template) {
			
			var filledInTemplate = template.replace("%ID%", id);
		 	filledInTemplate = filledInTemplate.replace("%IMAGE%", image);
		 	filledInTemplate = filledInTemplate.replace("%VORNAME%", vorname);
		 	filledInTemplate = filledInTemplate.replace("%NACHNAME%", nachname);
		 	filledInTemplate = filledInTemplate.replace("%TELEFON%", telefon);
		 	filledInTemplate = filledInTemplate.replace("%MAIL%", mail);
		 	filledInTemplate = filledInTemplate.replace("%POSITION%", position);
			
		 	node.append(filledInTemplate);  
		});
	}
	
  	function setTime(nodeName, dateNr, slotNr){
      	$("#calendar" + dateNr + "Wrapper").hide('fast');
      	
      	var uhrzeitText = $( nodeName ).find("h5").text();
 
      	var dateStr = "";
      	if(dateNr == 1) dateStr = picker1.formatDate(picker1.selectedDates[0], "d.m.Y");
      	if(dateNr == 2) dateStr = picker2.formatDate(picker2.selectedDates[0], "d.m.Y");
      	if(dateNr == 3) dateStr = picker3.formatDate(picker3.selectedDates[0], "d.m.Y");
      	
      	$("#appointment" + dateNr + "Selected").text(dateStr + ", " + uhrzeitText);
      	$("#appointment" + dateNr + "Selected").show('fast');   
      	
      	if($("#appointment1Selected").is(":visible") &&
      			$("#appointment2Selected").is(":visible") &&
      			$("#appointment3Selected").is(":visible")){
      		$( "#SummaryDisplayButton" ).show( 'slow' ); 
      	}

		$( "#selectedEmployee" + dateNr ).empty();
		
      	addTemplateMA($( "#selectedEmployee" + dateNr ), 
      				  $("#appointment_slot_" + dateNr + "_" + slotNr).find("#MA_ID").text(), 
      				  $("#appointment_slot_" + dateNr + "_" + slotNr).find("#MA_IMAGE").text(), 
      				  $("#appointment_slot_" + dateNr + "_" + slotNr).find("#MA_VORNAME").text(), 
      				  $("#appointment_slot_" + dateNr + "_" + slotNr).find("#MA_NACHNAME").text(), 
      				  $("#appointment_slot_" + dateNr + "_" + slotNr).find("#MA_TELEFON").text(), 
      				  $("#appointment_slot_" + dateNr + "_" + slotNr).find("#MA_MAIL").text(),
      				  $("#appointment_slot_" + dateNr + "_" + slotNr).find("#MA_POSITION").text());
      				  
      	$("#appointmentconnectedemployee" + dateNr).show('fast');
      	location.hash = "";
      	location.hash = "#appointmentContainer" +  dateNr;
    }
	
	function getUrlParams(){
		var params = {};

		if (location.search) {
		    var parts = location.search.substring(1).split('&');

		    for (var i = 0; i < parts.length; i++) {
		        var nv = parts[i].split('=');
		        if (!nv[0]) continue;
		        params[nv[0]] = nv[1] || true;
		    }
		}
		
		return params;
	}
  </script>
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
</body>
</html>